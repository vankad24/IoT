# üí° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ–º —Å –æ–±–º–µ–Ω–æ–º –¥–∞–Ω–Ω—ã–º–∏ –ø–æ MQTT

## üìò –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é IoT-—Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å–≤–µ—â–µ–Ω–∏–µ–º, –≥–¥–µ **–¥–≤–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞** –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å **–¥–≤—É–º—è –ü–ö** –ø–æ UART, –∞ –ü–ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç **–º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ MQTT**.
–°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç **—É–º–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ —Ç–µ–ø–ª–∏—Ü—ã**, –≥–¥–µ –æ–¥–∏–Ω –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–∑–º–µ—Ä—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏, –∞ –¥—Ä—É–≥–æ–π –≤–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –≤—ã–∫–ª—é—á–∞–µ—Ç —Å–≤–µ—Ç–æ–¥–∏–æ–¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
[Sensor MCU] <--UART--> [PC1: Python + MQTT Publisher]
                              |
                              v
                         [MQTT Broker]
                              |
                              v
[Actuator MCU] <--UART--> [PC2: Python + MQTT Subscriber]


                         [Monitor PC]
                              ^
                              |
                    (–ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≤—Å–µ —Ç–æ–ø–∏–∫–∏)
```

---

## ‚öôÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                               |
| -------------------------- | -------------------------------------------------------- |
| **Sensor MCU (Arduino)**   | –°—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Ñ–æ—Ç–æ—Ä–µ–∑–∏—Å—Ç–æ—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –ø–æ Serial |
| **PC1 (Publisher)**        | –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ UART –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –≤ MQTT            |
| **Actuator MCU (Arduino)** | –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥        |
| **PC2 (Subscriber)**       | –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ MQTT –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã LED-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É    |
| **Monitor PC**             | –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≤—Å–µ MQTT-—Ç–æ–ø–∏–∫–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã  |

---

## üîß –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —á–∞—Å—Ç—å

* 2 –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Arduino (–Ω–∞–ø—Ä–∏–º–µ—Ä, Uno)
* 1 —Ñ–æ—Ç–æ—Ä–µ–∑–∏—Å—Ç–æ—Ä (–ø–æ–¥–∫–ª—é—á—ë–Ω –∫ A0)
* 1 —Å–≤–µ—Ç–æ–¥–∏–æ–¥ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π –Ω–∞ –ø–∏–Ω–µ 13)
* 2 USB-–∫–∞–±–µ–ª—è
* 2 –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–∏–ª–∏ 1 —Å –¥–≤—É–º—è USB-–ø–æ—Ä—Ç–∞–º–∏)

---

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞

### Sensor MCU

**–ö–æ–º–∞–Ω–¥—ã (PC ‚Üí MCU):**

* `p` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏
* `s` ‚Äî –Ω–∞—á–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É
* `x` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É

**–û—Ç–≤–µ—Ç—ã (MCU ‚Üí PC):**

* `SENSOR_VALUE:<value>`
* `STREAM_STARTED` / `STREAM_STOPPED`

---

### Actuator MCU

**–ö–æ–º–∞–Ω–¥—ã (PC ‚Üí MCU):**

* `u` ‚Äî –≤–∫–ª—é—á–∏—Ç—å LED
* `d` ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å LED
* `b` ‚Äî –º–∏–≥–∞–Ω–∏–µ LED

**–û—Ç–≤–µ—Ç—ã (MCU ‚Üí PC):**

* `LED_ON`
* `LED_OFF`
* `LED_BLINK`

---

## üß† –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **Sensor MCU** –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ—Ä–µ–∑–∏—Å—Ç–æ—Ä–∞.
2. **PC1 (publisher.py)** –ø—É–±–ª–∏–∫—É–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ MQTT-—Ç–æ–ø–∏–∫ `laboratory/greenhouse/luminosity`.
3. **PC2 (subscriber.py)** –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —ç—Ç–æ—Ç —Ç–æ–ø–∏–∫ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä–æ–≥–∞ –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏ (`THRESHOLD = 24`).
4. **Monitor (monitor.py)** –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≤—Å–µ —Ç–æ–ø–∏–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### Windows

1. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   ```cmd
   create_venv.cmd
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö:

   **–ü–ö1 (Publisher):**

   ```cmd
   venv\Scripts\python .\python\publisher.py
   ```

   **–ü–ö2 (Subscriber):**

   ```cmd
   venv\Scripts\python .\python\subscriber.py
   ```

   **–ú–æ–Ω–∏—Ç–æ—Ä:**

   ```cmd
   venv\Scripts\python .\python\monitor.py
   ```

---

### üêß Linux

1. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   ```bash
   ./create_venv.sh
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö:

   **–ü–ö1 (Publisher):**

   ```bash
   ./venv/bin/python ./python/publisher.py
   ```

   **–ü–ö2 (Subscriber):**

   ```bash
   ./venv/bin/python ./python/subscriber.py
   ```

   **–ú–æ–Ω–∏—Ç–æ—Ä:**

   ```bash
   ./venv/bin/python ./python/monitor.py
   ```

---

## üß© MQTT-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

* **–ë—Ä–æ–∫–µ—Ä:** `broker.emqx.io`
* **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ–ø–∏–∫–∏:**

  * `laboratory/greenhouse/luminosity` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏
  * `laboratory/greenhouse/system` ‚Äî —Å–ª—É–∂–µ–±–Ω—ã–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –¢–µ—Å—Ç                                                   | –°—Ç–∞—Ç—É—Å |
| ------------------------------------------------------ | ------ |
| MCU-–¥–∞—Ç—á–∏–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É `p` –æ–¥–∏–Ω–æ—á–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º | [x]    |
| MCU-–¥–∞—Ç—á–∏–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É –ø–æ –∫–æ–º–∞–Ω–¥–µ `s`  | [x]    |
| MCU-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç LED –ø–æ –∫–æ–º–∞–Ω–¥–µ `u`            | [x]    |
| MCU-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤—ã–∫–ª—é—á–∞–µ—Ç LED –ø–æ –∫–æ–º–∞–Ω–¥–µ `d`           | [x]    |
| MCU-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–∏–≥–∞–µ—Ç LED –ø–æ –∫–æ–º–∞–Ω–¥–µ `b`              | [x]    |
| –í—Å–µ —Å—Ç–∞—Ç—É—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ MQTT   | [x]    |
| –ú–æ–Ω–∏—Ç–æ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã                   | [x]    |
| –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –±–µ–∑ –æ—à–∏–±–æ–∫                | [x]    |

---

## üîó –°—Å—ã–ª–∫–∏

* üé• ** [–í–∏–¥–µ–æ-–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã](https://disk.yandex.ru/i/2PXHI3womR3EWg) **
* üß∞ ** [Tinkercad-—Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è](https://www.tinkercad.com/things/4uBhdsxSkz7-ledphotoserialmqtt?sharecode=vRfdwrGlVYUay17DmYFu48ZNpZltLq6KJEtRHXailsE) **

---

## üìÑ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ UART –∏ MQTT.
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∞ –≥–∏–±–∫–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è IoT-—Å–∏—Å—Ç–µ–º–∞, —Å–ø–æ—Å–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, —Ç–∞–∫ –∏ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏.

---
